<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Markdown Editor</title>
        <link rel="icon" type="image/png" sizes="32x32" href="public/Icon.ico">
        <link rel="stylesheet" href="cdn/font/ubuntu-font.css" />
        <link rel="stylesheet" href="styles.css" />
        <link rel="stylesheet" href="styles-editor.css" />
        <link rel="stylesheet" href="cdn/prism/prism-dark-svc.css" />
        <link rel="stylesheet" href="cdn/monaco/editor.main.min.css" />
        <script src="cdn/prism/prism-core.min.js"></script>
        <script src="cdn/prism/prism-autoloader.min.js"></script>
        <script src="cdn/marked/marked.umd.js"></script>
        <script src="cdn/SVGpanzoom/svg-pan-zoom.min.js"></script>
        <script src="cdn/monaco/vs/loader.js"></script>
        <!-- <script src="components/script-all-pages.js"></script> -->
        <script type="importmap">
            {
                "imports": {
                    "preact": "./cdn/preact/preact.mjs",
                    "preact/hooks": "./cdn/preact/hooks.mjs",
                    "htm/preact": "./cdn/preact/htm-preact.mjs"
                }
            }
        </script>
    </head>
    <body>
        <div id="app"></div>

        <script type="module">
            import { render } from "preact";
            import { useState, useEffect, useRef } from "preact/hooks";
            import { html } from "htm/preact";
            import { Header } from "./components/Header.js";
            import { Sidebar, initSidebar } from "./components/Sidebar.js";
            import {
                renderMarkdown,
                showCopySuccess,
                manageEscapeIframe,
                manageClickFloatButton,
            } from "./components/markdownProcessor.js";

            // Configure Monaco Editor
            require.config({
                paths: {
                    vs: "./cdn/monaco/vs",
                },
            });
            
            // Configure the languages we want to load
            window.MonacoEnvironment = {
                getLanguages: function() {
                    return ['markdown'];
                }
            };

            // Handler for Escape key
            document.addEventListener("keydown", function (e) {
                if (e.key === "Escape") {
                    manageEscapeIframe();
                }
            });

            document.addEventListener("click", function (e) {
                manageClickFloatButton(e);

                // For the main copy button
                if (e.target.closest(".copy-button")) {
                    const button = e.target.closest(".copy-button");
                    const originalHTML = button.innerHTML;

                    if (window.handleCopy) {
                        window
                            .handleCopy()
                            .then(() => {
                                showCopySuccess(button, originalHTML);
                            })
                            .catch((err) => {
                                console.error("Error copying:", err);
                            });
                    }
                }
            });

            // Contenido por defecto para un nuevo documento
            const DEFAULT_MARKDOWN_CONTENT = `# My First Entry

This is an example of a **blog entry** with *italic text*.

## Feature List

- Support for **bold** and *italic*
- Numbered and bullet lists
- \`inline code\`
- Links: [Example](https://example.com)

:::details-open Collapsible Element
### This item is open by default
content
:::

### SVG Container

\`\`\`svgcontainer style="height:15em;"
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M3 21q-.825 0-1.412-.587T1 19V5q0-.825.588-1.412T3 3h18q.825 0 1.413.588T23 5v14q0 .825-.587 1.413T21 21zm4-4h2V7H5v2h2zm4.5 0h2l1.75-3.175L17 17h2l-2.75-5L19 7h-2l-1.75 3.175L13.5 7h-2l2.75 5z"/></svg>
\`\`\`

### Code Block

\`\`\`javascript
function hello() {
    console.log("Hello world!");
}
\`\`\`

### Example Table

| Column 1 | Column 2 | Column 3 |
|----------|----------|----------|
| Cell A   | Cell B   | Cell C   |
| Cell D   | Cell E   | Cell F   |

### Embedded Iframe

:::iframe
https://example.com
:::

### Blockquote

> This is a
> blockquote`;

            function MarkdownEditor() {
                const handleNavigateToEntry = (entry) => {
                    window.location.href = `./post.html?path=${encodeURIComponent(entry.path)}`;
                };
                
                const [isContentModified, setIsContentModified] = useState(false);
                // Intentar recuperar el contenido y configuración guardados de localStorage
                const savedContent = localStorage.getItem('editorContent');
                const savedShowPreview = localStorage.getItem('editorShowPreview');
                const savedPreviewPosition = localStorage.getItem('editorPreviewPosition');
                const [markdown, setMarkdown] = useState(savedContent || DEFAULT_MARKDOWN_CONTENT);

                const [preview, setPreview] = useState("");
                const [showPreview, setShowPreview] = useState(savedShowPreview === 'true' ? true : false);
                const [previewPosition, setPreviewPosition] = useState(savedPreviewPosition === 'bottom' ? 'bottom' : 'right'); // 'right' o 'bottom'
                const editorRef = useRef(null);
                const containerRef = useRef(null);

                useEffect(() => {
                    if (showPreview){
                        let [finalHtml, sidebarContent, finalJS] = renderMarkdown(markdown);
                        setPreview(finalHtml);
                        setTimeout(() => {
                            // Usar la función initSidebar que maneja de forma segura la inicialización/actualización
                            initSidebar(sidebarContent);
                            eval(finalJS);
                        }, 100);
                    }
                }, [showPreview, markdown]);

                useEffect(() => {
                    if (showPreview) {
                        setTimeout(() => {
                            if (window.Prism) {
                                window.Prism.highlightAll();
                            }
                        }, 100);
                    }
                }, [showPreview, preview]);

                // Efecto para controlar la alerta al cerrar o navegar fuera de la página
                useEffect(() => {
                    const handleBeforeUnload = (e) => {
                        if (isContentModified) {
                            // Intentar guardar una última vez en localStorage
                            try {
                                if (editorRef.current) {
                                    const content = editorRef.current.getValue();
                                    localStorage.setItem('editorContent', content);
                                    // Si se guarda correctamente, no mostramos alerta
                                    return;
                                }
                            } catch (error) {
                                // Si falla el guardado, mostramos la alerta
                                e.preventDefault();
                                e.returnValue = "No se pudieron guardar los cambios automáticamente. ¿Seguro que quieres salir?";
                                return e.returnValue;
                            }
                        }
                    };
                    
                    window.addEventListener('beforeunload', handleBeforeUnload);
                    
                    return () => {
                        window.removeEventListener('beforeunload', handleBeforeUnload);
                    };
                }, [isContentModified]);

                useEffect(() => {
                    if (!editorRef.current) {
                        // La configuración ya está hecha arriba

                        require(["vs/editor/editor.main"], () => {
                            editorRef.current = monaco.editor.create(
                                containerRef.current,
                                {
                                    value: markdown,
                                    language: "markdown",
                                    theme: "vs-dark",
                                    minimap: { enabled: true },
                                    fontSize: 16,
                                    lineNumbers: "on",
                                    roundedSelection: false,
                                    scrollBeyondLastLine: false,
                                    wordWrap: "on",
                                    acceptSuggestionOnEnter: "off",
                                    automaticLayout: true,
                                    smoothScrolling: true,
                                }
                            );

                            // Añadir el manejador para teclas
                            editorRef.current.addAction({
                                id: 'extend-numbered-list',
                                label: 'Extend Numbered List',
                                keybindings: [monaco.KeyCode.Enter],
                                precondition: null,
                                keybindingContext: null,
                                contextMenuGroupId: 'navigation',
                                contextMenuOrder: 1.5,
                                // Método que se ejecutará
                                run: function(ed) {
                                    const editor = editorRef.current;
                                    const selection = editor.getSelection();
                                    const position = {
                                        lineNumber: selection.startLineNumber,
                                        column: selection.startColumn
                                    };
                                    const model = editor.getModel();
                                    const lineContent = model.getLineContent(position.lineNumber);
                                    
                                    // Expresión regular para detectar líneas numeradas (ej: "1. ", "12. ")
                                    const numberedListRegex = /^(\d+)\.(\s+)(.*)$/;
                                    const match = lineContent.match(numberedListRegex);
                                    
                                    if (match) {
                                        // Si la línea actual está vacía después del número (ej: "1. "), terminar la lista
                                        if (match[3].trim() === '') {
                                            // Eliminar la línea actual y añadir una línea en blanco
                                            const range = {
                                                startLineNumber: position.lineNumber,
                                                startColumn: 1,
                                                endLineNumber: position.lineNumber,
                                                endColumn: lineContent.length + 1
                                            };
                                            editor.executeEdits('', [{
                                                range: range,
                                                text: ''
                                            }]);
                                            return true; // Prevenir el comportamiento por defecto
                                        }
                                        
                                        const currentNumber = parseInt(match[1], 10);
                                        const nextNumber = currentNumber + 1;
                                        const spacing = match[2]; // Conservar el mismo espaciado
                                        
                                        // Insertar una nueva línea con el siguiente número
                                        const text = '\n' + nextNumber + '.' + spacing;
                                        editor.executeEdits('', [{
                                            range: {
                                                startLineNumber: position.lineNumber,
                                                startColumn: model.getLineMaxColumn(position.lineNumber),
                                                endLineNumber: position.lineNumber,
                                                endColumn: model.getLineMaxColumn(position.lineNumber)
                                            },
                                            text: text
                                        }]);
                                        
                                        // Mover el cursor a la nueva línea después del número
                                        editor.setPosition({
                                            lineNumber: position.lineNumber + 1,
                                            column: (nextNumber + '.').length + spacing.length + 1
                                        });
                                        
                                        return true; // Completado
                                    }
                                    
                                    // Si no es una lista numerada, usar el comportamiento predeterminado de Enter
                                    editor.trigger('keyboard', 'type', { text: '\n' });
                                    return true;
                                }
                            });
                            
                            editorRef.current.onDidChangeModelContent(() => {
                                const content = editorRef.current.getValue();
                                setMarkdown(content);
                                setIsContentModified(true);
                                
                                // Guardar en localStorage
                                try {
                                    localStorage.setItem('editorContent', content);
                                } catch (e) {
                                    console.warn('No se pudo guardar en localStorage:', e);
                                    // Si falla el guardado, mantenemos isContentModified en true
                                    // para que se muestre la alerta al salir
                                }
                            });
                        });
                    }
                }, []);

                const insertText = (
                    beforeText,
                    afterText = "",
                    insertAtStart = false
                ) => {
                    if (!editorRef.current) return;

                    const editor = editorRef.current;
                    const selection = editor.getSelection();
                    const selectedText = editor
                        .getModel()
                        .getValueInRange(selection);

                    // If no text is selected and insertAtStart is true
                    if (selection.isEmpty() && insertAtStart) {
                        const lineNumber = selection.startLineNumber;
                        const lineContent = editor
                            .getModel()
                            .getLineContent(lineNumber);

                        // Detect if there's already a header at the beginning
                        const headerRegex = /^(#{1,6}\s|#t\s)/;
                        const match = lineContent.match(headerRegex);

                        const lineStart = {
                            startLineNumber: lineNumber,
                            startColumn: 1,
                            endLineNumber: lineNumber,
                            endColumn: lineContent.length + 1,
                        };

                        let newText;
                        if (match) {
                            // If there's already a header, replace it
                            newText =
                                beforeText +
                                lineContent.substring(match[0].length) +
                                afterText;
                        } else {
                            // If there's no header, add a new one
                            newText = beforeText + lineContent + afterText;
                        }

                        // Edit at the beginning of the line
                        editor.executeEdits("", [
                            {
                                range: lineStart,
                                text: newText,
                            },
                        ]);
                    } else {
                        // Normal behavior when text is selected
                        const newText = beforeText + selectedText + afterText;

                        // Realiza la edición
                        editor.executeEdits("", [
                            {
                                range: selection,
                                text: newText,
                            },
                        ]);
                    }
                    // Calculate where the cursor will be: right after beforeText + selectedText
                    let lines = (beforeText + selectedText).split("\n");
                    let newLineNumber =
                        selection.startLineNumber + (lines.length - 1);
                    let newColumn;

                    if (lines.length === 1) {
                        // Everything on the same line
                        newColumn = selection.startColumn + lines[0].length;
                    } else {
                        // Last line of the block
                        newColumn = lines[lines.length - 1].length + 1;
                    }

                    // Posiciona el cursor
                    editor.setSelection({
                        startLineNumber: newLineNumber,
                        startColumn: newColumn,
                        endLineNumber: newLineNumber,
                        endColumn: newColumn,
                    });

                    // Center the cursor line on the screen with smooth animation
                                        // Center the cursor line on the screen
                    editor.revealLineInCenter(newLineNumber, monaco.editor.ScrollType.Smooth);
                    
                    editor.focus();
                };

                const handleSave = () => {
                    const blob = new Blob([markdown], {
                        type: "text/markdown",
                    });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "post.md";
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // Actualizar localStorage y marcar como guardado
                    try {
                        localStorage.setItem('editorContent', markdown);
                        setIsContentModified(false); // Marcamos el contenido como guardado
                    } catch (e) {
                        console.warn('No se pudo guardar en localStorage:', e);
                        // Aún así marcamos como guardado porque se guardó como archivo
                        setIsContentModified(false);
                    }
                };

                const handleCopy = async () => {
                    try {
                        await navigator.clipboard.writeText(markdown);
                        return Promise.resolve();
                    } catch (err) {
                        console.error("Error copying to clipboard:", err);
                        return Promise.reject(err);
                    }
                };

                // Make the handleCopy function globally accessible
                window.handleCopy = handleCopy;

                const handleExport = () => {
                    const blob = new Blob([preview], { type: "text/html" });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "post.html";
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                };

                const insertIframe = () => {
                    const url = prompt("Enter the iframe URL:");
                    if (url) {
                        insertText(`\n:::iframe height="27em"\n${url}\n:::\n`);
                    }
                };

                // Function to generate markdown tables
                const generateTable = (rows, columns) => {
                    if (!isNaN(rows) && !isNaN(columns) && rows > 0 && columns > 0) {
                        // Build header
                        let table = "\n|";
                        for (let i = 1; i <= columns; i++) {
                            table += ` Column ${i} |`;
                        }

                        // Build separator
                        table += "\n|";
                        for (let i = 1; i <= columns; i++) {
                            table += "----------|";
                        }

                        // Build rows
                        for (let i = 1; i <= rows; i++) {
                            table += "\n|";
                            for (let j = 1; j <= columns; j++) {
                                table += ` Cell ${String.fromCharCode(64 + j)}${i} |`;
                            }
                        }

                        insertText(table + "\n", "\n");
                        return true;
                    }
                    return false;
                };

                return html`
                    <div class="app">
                        <${Header} 
                            showSearch=${true} 
                            onNavigateToEntry=${(entry) => {
                                window.location.href = `./post.html?path=${encodeURIComponent(entry.path)}`;
                            }} 
                        />

                        <main class="main-container">
                            <${Sidebar} />
                            <div class="editor-container">
                                <div
                                    style="display: flex; gap: var(--spacing-sm); padding: var(--spacing-sm); background-color: var(--bg-secondary); border-bottom: none; border-radius: var(--border-radius) var(--border-radius) 0 0; align-items: center;justify-content: space-between;"
                                >
                                    <div class="editor-menu">
                                        <button
                                            class="menu-trigger"
                                            onClick=${(e) => {
                                                const menu =
                                                    e.currentTarget
                                                        .nextElementSibling;
                                                const isVisible =
                                                    menu.style.display ===
                                                    "block";
                                                menu.style.display = isVisible
                                                    ? "none"
                                                    : "block";

                                                if (!isVisible) {
                                                    const closeMenu = (
                                                        event
                                                    ) => {
                                                        if (
                                                            !menu.contains(
                                                                event.target
                                                            ) &&
                                                            !e.target.contains(
                                                                event.target
                                                            )
                                                        ) {
                                                            menu.style.display =
                                                                "none";
                                                            document.removeEventListener(
                                                                "click",
                                                                closeMenu
                                                            );
                                                        }
                                                    };
                                                    // Usar setTimeout para evitar que el evento click actual cierre inmediatamente el menú
                                                    setTimeout(
                                                        () =>
                                                            document.addEventListener(
                                                                "click",
                                                                closeMenu
                                                            ),
                                                        0
                                                    );
                                                }
                                            }}
                                        >
                                            <svg
                                                width="16"
                                                height="16"
                                                viewBox="0 0 16 16"
                                                fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path
                                                    d="M2 4h12M2 8h12M2 12h12"
                                                    stroke="currentColor"
                                                    stroke-width="2"
                                                    stroke-linecap="round"
                                                />
                                            </svg>
                                        </button>
                                        <div
                                            class="menu-content"
                                            style="display: none;"
                                        >
                                            <button onClick=${handleSave}>
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                >
                                                    <path
                                                        d="M13 13H3a2 2 0 01-2-2V3a2 2 0 012-2h8l4 4v6a2 2 0 01-2 2z"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                                Guardar (.md)
                                            </button>
                                            <button onClick=${handleExport}>
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                >
                                                    <path
                                                        d="M14 10v2a2 2 0 01-2 2H4a2 2 0 01-2-2v-2M8 2v8M5 5l3-3 3 3"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                                Exportar HTML
                                            </button>
                                            <button onClick=${() => {
                                                if (confirm("¿Crear nuevo documento? Se perderán los cambios no guardados.")) {
                                                    // Solo limpiamos el contenido, mantenemos las preferencias de vista
                                                    localStorage.removeItem('editorContent');
                                                    
                                                    // Usamos la constante con el contenido por defecto
                                                    const newContent = DEFAULT_MARKDOWN_CONTENT;
                                                    
                                                    // Primero actualizamos el editor directamente
                                                    if (editorRef.current) {
                                                        editorRef.current.setValue(newContent);
                                                    }
                                                    
                                                    // Luego actualizamos el estado
                                                    setMarkdown(newContent);
                                                    setIsContentModified(false);
                                                }
                                            }}>
                                                <svg
                                                    width="16"
                                                    height="16"
                                                    viewBox="0 0 16 16"
                                                    fill="none"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                >
                                                    <path
                                                        d="M9 1H3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V7"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                    <path
                                                        d="M14 1v4h-4M14 1L7 8"
                                                        stroke="currentColor"
                                                        stroke-width="2"
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                    />
                                                </svg>
                                                Nuevo documento
                                            </button>
                                        </div>
                                    </div>
                                    <div class="editor-toolbar">
                                        <button
                                            class="editor-menu"
                                            style="padding-left: 4px;"
                                            onClick=${(e) => {
                                                // Solo actuar si el click fue directamente en el botón principal (no en los hijos)
                                                if (
                                                    e.target === e.currentTarget
                                                ) {
                                                    const menu =
                                                        e.currentTarget.querySelector(
                                                            ".menu-content"
                                                        );
                                                    const isVisible =
                                                        menu.style.display ===
                                                        "block";
                                                    menu.style.display =
                                                        isVisible
                                                            ? "none"
                                                            : "block";

                                                    if (!isVisible) {
                                                        const closeMenu = (
                                                            event
                                                        ) => {
                                                            if (
                                                                !menu.contains(
                                                                    event.target
                                                                ) &&
                                                                !e.target.contains(
                                                                    event.target
                                                                )
                                                            ) {
                                                                menu.style.display =
                                                                    "none";
                                                                document.removeEventListener(
                                                                    "click",
                                                                    closeMenu
                                                                );
                                                            }
                                                        };
                                                        setTimeout(
                                                            () =>
                                                                document.addEventListener(
                                                                    "click",
                                                                    closeMenu
                                                                ),
                                                            0
                                                        );
                                                    }
                                                }
                                            }}
                                            title="Header"
                                        >
                                            H
                                            <div
                                                class="menu-content"
                                                style="display: none;"
                                            >
                                                <button
                                                    onClick=${(e) => {
                                                        insertText(
                                                            "# ",
                                                            "",
                                                            true
                                                        );
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    H1 - Main Title
                                                </button>
                                                <button
                                                    onClick=${(e) => {
                                                        insertText(
                                                            "## ",
                                                            "",
                                                            true
                                                        );
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    H2 - Subtitle
                                                </button>
                                                <button
                                                    onClick=${(e) => {
                                                        insertText(
                                                            "### ",
                                                            "",
                                                            true
                                                        );
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    H3 - Heading 3
                                                </button>
                                                <button
                                                    onClick=${(e) => {
                                                        insertText(
                                                            "#### ",
                                                            "",
                                                            true
                                                        );
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    H4 - Heading 4
                                                </button>
                                                <button
                                                    onClick=${(e) => {
                                                        insertText(
                                                            "##### ",
                                                            "",
                                                            true
                                                        );
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    H5 - Heading 5
                                                </button>
                                                <button
                                                    onClick=${(e) => {
                                                        insertText(
                                                            "###### ",
                                                            "",
                                                            true
                                                        );
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    H6 - Heading 6
                                                </button>
                                                <button
                                                    onClick=${(e) => {
                                                        insertText(
                                                            "#t ",
                                                            "",
                                                            true
                                                        );
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    Text - Normal Text
                                                </button>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 24 18" style="pointer-events: none;"><path fill="currentColor" d="m12 15.4l-6-6L7.4 8l4.6 4.6L16.6 8L18 9.4z"></path></svg>
                                        </button>
                                        <button
                                            class="editor-menu"
                                            style="padding-left: 4px;"
                                            onClick=${(e) => {
                                                if (
                                                    e.target === e.currentTarget
                                                ) {
                                                    const menu =
                                                        e.currentTarget.querySelector(
                                                            ".menu-content"
                                                        );
                                                    const isVisible =
                                                        menu.style.display ===
                                                        "block";
                                                    menu.style.display =
                                                        isVisible
                                                            ? "none"
                                                            : "block";

                                                    if (!isVisible) {
                                                        const closeMenu = (
                                                            event
                                                        ) => {
                                                            if (
                                                                !menu.contains(
                                                                    event.target
                                                                ) &&
                                                                !e.target.contains(
                                                                    event.target
                                                                )
                                                            ) {
                                                                menu.style.display =
                                                                    "none";
                                                                document.removeEventListener(
                                                                    "click",
                                                                    closeMenu
                                                                );
                                                            }
                                                        };
                                                        setTimeout(
                                                            () =>
                                                                document.addEventListener(
                                                                    "click",
                                                                    closeMenu
                                                                ),
                                                            0
                                                        );
                                                    }
                                                }
                                            }}
                                            title="List"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 23 18" style="pointer-events: none;"><path fill="currentColor" d="M7 9V7h14v2zm0 4v-2h14v2zm0 4v-2h14v2zM4 9q-.425 0-.712-.288T3 8t.288-.712T4 7t.713.288T5 8t-.288.713T4 9m0 4q-.425 0-.712-.288T3 12t.288-.712T4 11t.713.288T5 12t-.288.713T4 13m0 4q-.425 0-.712-.288T3 16t.288-.712T4 15t.713.288T5 16t-.288.713T4 17"></path></svg>
                                            <div
                                                class="menu-content"
                                                style="display: none;"
                                            >
                                                <button 
                                                    style="display: flex; align-items: center; width: 100%; text-align: left; padding: 8px 12px; border: none; background: none; cursor: pointer; color: var(--text-color); font-size: 14px;"
                                                    onClick=${(e) => {
                                                        // Primero verificar si estamos en una línea de lista
                                                        if (!editorRef.current) return;
                                                        
                                                        const editor = editorRef.current;
                                                        const selection = editor.getSelection();
                                                        const lineNumber = selection.startLineNumber;
                                                        const lineContent = editor.getModel().getLineContent(lineNumber);
                                                        
                                                        // Detectar si ya es una lista numerada
                                                        const numberedListRegex = /^(\d+)\.(\s+)(.*)$/;
                                                        const bulletListRegex = /^(-|\*|\+)(\s+)(.*)$/;
                                                        
                                                        const numberedMatch = lineContent.match(numberedListRegex);
                                                        const bulletMatch = lineContent.match(bulletListRegex);
                                                        
                                                        if (numberedMatch) {
                                                            // Convertir de lista numerada a lista con viñetas
                                                            const range = {
                                                                startLineNumber: lineNumber,
                                                                startColumn: 1,
                                                                endLineNumber: lineNumber,
                                                                endColumn: numberedMatch[0].length + 1
                                                            };
                                                            
                                                            // Reemplazar "1. " con "- "
                                                            editor.executeEdits('', [{
                                                                range: range,
                                                                text: '- ' + numberedMatch[3]
                                                            }]);
                                                        } else if (bulletMatch) {
                                                            // Ya es una lista con viñetas, no hacer nada
                                                            // O cambiar el tipo de viñeta si se quiere
                                                            if (bulletMatch[1] !== '-') {
                                                                const range = {
                                                                    startLineNumber: lineNumber,
                                                                    startColumn: 1,
                                                                    endLineNumber: lineNumber,
                                                                    endColumn: bulletMatch[0].length + 1
                                                                };
                                                                
                                                                editor.executeEdits('', [{
                                                                    range: range,
                                                                    text: '- ' + bulletMatch[3]
                                                                }]);
                                                            }
                                                        } else {
                                                            // No es ningún tipo de lista, añadir al principio
                                                            insertText("- ", "", true);
                                                        }
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 23 18" style="margin-right: 8px;"><path fill="currentColor" d="M7 9V7h14v2zm0 4v-2h14v2zm0 4v-2h14v2zM4 9q-.425 0-.712-.288T3 8t.288-.712T4 7t.713.288T5 8t-.288.713T4 9m0 4q-.425 0-.712-.288T3 12t.288-.712T4 11t.713.288T5 12t-.288.713T4 13m0 4q-.425 0-.712-.288T3 16t.288-.712T4 15t.713.288T5 16t-.288.713T4 17"></path></svg>
                                                    Bulleted list
                                                </button>
                                                <button 
                                                    style="display: flex; align-items: center; width: 100%; text-align: left; padding: 8px 12px; border: none; background: none; cursor: pointer; color: var(--text-color); font-size: 14px;"
                                                    onClick=${(e) => {
                                                        // Primero verificar si estamos en una línea de lista
                                                        if (!editorRef.current) return;
                                                        
                                                        const editor = editorRef.current;
                                                        const selection = editor.getSelection();
                                                        const lineNumber = selection.startLineNumber;
                                                        const lineContent = editor.getModel().getLineContent(lineNumber);
                                                        
                                                        // Detectar si ya es una lista numerada
                                                        const numberedListRegex = /^(\d+)\.(\s+)(.*)$/;
                                                        const bulletListRegex = /^(-|\*|\+)(\s+)(.*)$/;
                                                        
                                                        const numberedMatch = lineContent.match(numberedListRegex);
                                                        const bulletMatch = lineContent.match(bulletListRegex);
                                                        
                                                        if (bulletMatch) {
                                                            // Convertir de lista con viñetas a lista numerada
                                                            const range = {
                                                                startLineNumber: lineNumber,
                                                                startColumn: 1,
                                                                endLineNumber: lineNumber,
                                                                endColumn: bulletMatch[0].length + 1
                                                            };
                                                            
                                                            // Reemplazar "- " con "1. "
                                                            editor.executeEdits('', [{
                                                                range: range,
                                                                text: '1. ' + bulletMatch[3]
                                                            }]);
                                                        } else if (numberedMatch) {
                                                            // Ya es una lista numerada, verificar si queremos cambiar el número
                                                            if (numberedMatch[1] !== '1') {
                                                                const range = {
                                                                    startLineNumber: lineNumber,
                                                                    startColumn: 1,
                                                                    endLineNumber: lineNumber,
                                                                    endColumn: numberedMatch[0].length + 1
                                                                };
                                                                
                                                                editor.executeEdits('', [{
                                                                    range: range,
                                                                    text: '1. ' + numberedMatch[3]
                                                                }]);
                                                            }
                                                        } else {
                                                            // No es ningún tipo de lista, añadir al principio
                                                            insertText("1. ", "", true);
                                                        }
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 23 18" style="margin-right: 8px;"><path fill="currentColor" d="M3 22v-1.5h2.5v-.75H4v-1.5h1.5v-.75H3V16h3q.425 0 .713.288T7 17v1q0 .425-.288.713T6 19q.425 0 .713.288T7 20v1q0 .425-.288.713T6 22zm0-7v-2.75q0-.425.288-.712T4 11.25h1.5v-.75H3V9h3q.425 0 .713.288T7 10v1.75q0 .425-.288.713T6 12.75H4.5v.75H7V15zm1.5-7V3.5H3V2h3v6zM9 19v-2h12v2zm0-6v-2h12v2zm0-6V5h12v2z"/></svg>
                                                    Numbered list
                                                </button>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 24 18" style="pointer-events: none;"><path fill="currentColor" d="m12 15.4l-6-6L7.4 8l4.6 4.6L16.6 8L18 9.4z"></path></svg>
                                        </button>
                                        <button
                                            onClick=${() =>
                                                insertText("**", "**")}
                                            title="Bold type"
                                        >
                                            <strong>B</strong>
                                        </button>
                                        <button
                                            onClick=${() =>
                                                insertText("*", "*")}
                                            title="Italics"
                                        >
                                            <em>C</em>
                                        </button>
                                        <button
                                            onClick=${() =>
                                                insertText("[", " new](url)")}
                                            title="Link"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 18"><path fill="currentColor" d="M11 17H7q-2.075 0-3.537-1.463T2 12t1.463-3.537T7 7h4v2H7q-1.25 0-2.125.875T4 12t.875 2.125T7 15h4zm-3-4v-2h8v2zm5 4v-2h4q1.25 0 2.125-.875T20 12t-.875-2.125T17 9h-4V7h4q2.075 0 3.538 1.463T22 12t-1.463 3.538T17 17z"/></svg>
                                        </button>
                                        <button
                                            onClick=${() =>
                                                insertText("![alt](", ")")}
                                            title="Image"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 18"><path fill="currentColor" d="M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-2h14V5H5zm1-2h12l-3.75-5l-3 4L9 13zm-1 2V5zm3.5-9q.625 0 1.063-.437T10 8.5t-.437-1.062T8.5 7t-1.062.438T7 8.5t.438 1.063T8.5 10"/></svg>
                                        </button>
                                        <div class="toolbar-separator"></div>
                                        
                                        <button
                                            class="editor-menu"
                                            style="padding-left: 4px;"
                                            onClick=${(e) => {
                                                if (
                                                    e.target === e.currentTarget
                                                ) {
                                                    const menu =
                                                        e.currentTarget.querySelector(
                                                            ".menu-content"
                                                        );
                                                    const isVisible =
                                                        menu.style.display ===
                                                        "block";
                                                    menu.style.display =
                                                        isVisible
                                                            ? "none"
                                                            : "block";

                                                    if (!isVisible) {
                                                        const closeMenu = (
                                                            event
                                                        ) => {
                                                            if (
                                                                !menu.contains(
                                                                    event.target
                                                                ) &&
                                                                !e.target.contains(
                                                                    event.target
                                                                )
                                                            ) {
                                                                menu.style.display =
                                                                    "none";
                                                                document.removeEventListener(
                                                                    "click",
                                                                    closeMenu
                                                                );
                                                            }
                                                        };
                                                        setTimeout(
                                                            () =>
                                                                document.addEventListener(
                                                                    "click",
                                                                    closeMenu
                                                                ),
                                                            0
                                                        );
                                                    }
                                                }
                                            }}
                                            title="Code"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 18" style="pointer-events: none;"><path fill="currentColor" d="m8 18l-6-6l6-6l1.425 1.425l-4.6 4.6L9.4 16.6zm8 0l-1.425-1.425l4.6-4.6L14.6 7.4L16 6l6 6z"/></svg>
                                            <div
                                                class="menu-content"
                                                style="display: none;"
                                            >
                                                <button
                                                    onClick=${(e) => {
                                                        insertText("`", "`");
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    one-line code
                                                </button>
                                                <button
                                                    onClick=${(e) => {
                                                        insertText(
                                                            "\n```\n",
                                                            "\n```\n"
                                                        );
                                                        e.currentTarget.parentElement.style.display =
                                                            "none";
                                                    }}
                                                >
                                                    Code block
                                                </button>
                                                ${
                                                    // Lista de lenguajes de programación para los bloques de código
                                                    (() => {
                                                        const codeLanguages = "css+javascript+c+csharp+json+markdown+plsql+powershell+python+sql+typescript".split('+');
                                                        return codeLanguages.map(lang => {
                                                            // Formatear el nombre del lenguaje para mostrar (primera letra en mayúscula)
                                                            const displayName = lang.charAt(0).toUpperCase() + lang.slice(1);
                                                            return html`
                                                                <button
                                                                    onClick=${(e) => {
                                                                        insertText(
                                                                            `\n\`\`\`${lang}\n`,
                                                                            "\n```\n"
                                                                        );
                                                                        e.currentTarget.parentElement.style.display = "none";
                                                                    }}
                                                                >
                                                                    ${displayName} Block
                                                                </button>
                                                            `;
                                                        });
                                                    })()
                                                }
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 24 18" style="pointer-events: none;"><path fill="currentColor" d="m12 15.4l-6-6L7.4 8l4.6 4.6L16.6 8L18 9.4z"></path></svg>
                                        </button>
                                        
                                        <button
                                            onClick=${() =>
                                                insertText("> ", "")}
                                            title="Appointment"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 23 18" style="pointer-events: none;"><path fill="currentColor" d="M2 20V4h20v16zm3-3h14v-2H5zm0-4h14v-2H5zm0-4h10V7H5z"></path></svg>
                                        </button>

                                        <button
                                            onClick=${insertIframe}
                                            title="Iframe"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="20" viewBox="0 0 2048 1548"><path fill="currentColor" d="M960 768q93 0 174 35t142 96t96 142t36 175q0 93-35 174t-96 142t-142 96t-175 36q-93 0-174-35t-142-96t-96-142t-36-175q0-93 35-174t96-142t142-96t175-36m346 384q-15-80-63-145t-120-103q29 58 42 121t17 127zm-221 128H834q1 16 4 44t10 60t17 64t24 59t31 44t40 17q21 0 38-17t30-44t24-60t17-65t11-59t5-43m-251-128h252q-1-15-5-42t-11-59t-17-65t-24-60t-31-45t-38-17q-22 0-39 17t-31 44t-24 60t-17 65t-10 59t-5 43m-41-246q-35 19-64 45t-53 57t-39 68t-23 76h124q4-63 16-125t39-121m-179 374q14 78 61 142t116 103q-26-57-37-119t-16-126zm510 248q71-38 119-103t63-145h-124q-5 63-18 126t-40 122M1115 0l549 549v1371H256V0zm37 219v293h293zM384 1792h1152V640h-512V128H384z"></path></svg>
                                        </button>
                                        
                                        <button
                                            onClick=${() =>
                                                insertText('\n```svgcontainer style="height:15em;"\n', "\n```\n")}
                                            title="SVG Container"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 18"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 8h-2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2v-4h-1M7 8H4a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H3m7-8l1.5 8h1L14 8"/></svg>
                                        </button>
                                        <button
                                            onClick=${() =>
                                                insertText("\n:::details-open Collapsible Element\n", "\n:::\n")}
                                            title="Collapsible Element"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 25 18"><path fill="currentColor" d="M11.65 14.65q.15.15.35.15t.35-.15l2.8-2.8q.25-.25.125-.55T14.8 11H9.2q-.35 0-.475.3t.125.55zM12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"/></svg>
                                        </button>
                                        <button
                                            class="editor-menu"
                                            style="padding-left: 4px;"
                                            onClick=${(e) => {
                                                // Solo actuar si el click fue directamente en el botón principal (no en los hijos)
                                                if (
                                                    e.target === e.currentTarget
                                                ) {
                                                    const menu =
                                                        e.currentTarget.querySelector(
                                                            ".menu-content"
                                                        );
                                                    const isVisible =
                                                        menu.style.display ===
                                                        "block";
                                                    menu.style.display =
                                                        isVisible
                                                            ? "none"
                                                            : "block";

                                                    if (!isVisible) {
                                                        // Inicializamos el grid selector cuando se abre el menú
                                                        setTimeout(() => {
                                                            const tableGrid = menu.querySelector(".table-grid-container");
                                                            const dimensionsEl = menu.querySelector(".table-grid-dimensions");
                                                            
                                                            if (tableGrid) {
                                                                // Inicializamos la función de actualización
                                                                const updateActiveCells = (rows, cols) => {
                                                                    const cells = tableGrid.querySelectorAll('.table-grid-cell');
                                                                    cells.forEach((cell, index) => {
                                                                        const cellRow = Math.floor(index / 10) + 1;
                                                                        const cellCol = (index % 10) + 1;
                                                                        
                                                                        if (cellRow <= rows && cellCol <= cols) {
                                                                            cell.classList.add('active');
                                                                        } else {
                                                                            cell.classList.remove('active');
                                                                        }
                                                                    });
                                                                    
                                                                    if (dimensionsEl) {
                                                                        dimensionsEl.textContent = `${cols}x${rows}`;
                                                                    }
                                                                };
                                                                
                                                                // Inicializamos la cuadrícula con 1x1
                                                                updateActiveCells(1, 1);
                                                                
                                                                // Solo configuramos los eventos si no están ya configurados
                                                                if (!tableGrid.hasInitializedEvents) {
                                                                    // Evento para el hover
                                                                    tableGrid.mousemoveHandler = (event) => {
                                                                        const cell = event.target;
                                                                        if (cell.classList.contains('table-grid-cell')) {
                                                                            const index = Array.from(tableGrid.children).indexOf(cell);
                                                                            const hoveredRows = Math.floor(index / 10) + 1;
                                                                            const hoveredCols = (index % 10) + 1;
                                                                            updateActiveCells(hoveredRows, hoveredCols);
                                                                        }
                                                                    };
                                                                    
                                                                    // Evento para el click
                                                                    tableGrid.clickHandler = (event) => {
                                                                        const cell = event.target;
                                                                        if (cell.classList.contains('table-grid-cell')) {
                                                                            const index = Array.from(tableGrid.children).indexOf(cell);
                                                                            const rows = Math.floor(index / 10) + 1;
                                                                            const cols = (index % 10) + 1;
                                                                            
                                                                            // Generar e insertar la tabla
                                                                            generateTable(rows, cols);
                                                                            menu.style.display = "none";
                                                                        }
                                                                    };
                                                                    
                                                                    // Añadimos los listeners
                                                                    tableGrid.addEventListener('mousemove', tableGrid.mousemoveHandler);
                                                                    tableGrid.addEventListener('click', tableGrid.clickHandler);
                                                                    
                                                                    // Marcamos que ya se inicializaron
                                                                    tableGrid.hasInitializedEvents = true;
                                                                }
                                                            }
                                                        }, 0);
                                                        
                                                        const closeMenu = (
                                                            event
                                                        ) => {
                                                            if (
                                                                !menu.contains(
                                                                    event.target
                                                                ) &&
                                                                !e.target.contains(
                                                                    event.target
                                                                )
                                                            ) {
                                                                menu.style.display = "none";
                                                                document.removeEventListener(
                                                                    "click",
                                                                    closeMenu
                                                                );
                                                                // No necesitamos eliminar los event listeners
                                                                // ya que los mantenemos durante toda la vida del componente
                                                            }
                                                        };
                                                        setTimeout(
                                                            () =>
                                                                document.addEventListener(
                                                                    "click",
                                                                    closeMenu
                                                                ),
                                                            0
                                                        );
                                                    }
                                                }
                                            }}
                                            title="Table"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 23 18" style="pointer-events: none;"><path fill="currentColor" d="M4 21q-.825 0-1.412-.587T2 19V5q0-.825.588-1.412T4 3h16q.825 0 1.413.588T22 5v14q0 .825-.587 1.413T20 21zm0-2h4v-7H4zm0-9h4V5H4zm6 9h4v-7h-4zm0-9h4V5h-4zm6 9h4v-7h-4zm0-9h4V5h-4z"/></svg>
                                            <div
                                                class="menu-content"
                                                style="display: none; width: 300px;"
                                            >
                                                <div class="table-grid-selector">
                                                    <div class="table-grid-header">
                                                        <span>Insert table</span>
                                                        <span class="table-grid-dimensions">1x1</span>
                                                    </div>
                                                    
                                                    <div class="table-grid-container">
                                                        <!-- Generate 10x10 cells for the grid -->
                                                        ${Array.from({ length: 100 }).map((_, i) => (
                                                            html`<div class="table-grid-cell" key=${i}></div>`
                                                        ))}
                                                    </div>
                                                    
                                                    <div class="table-grid-custom">
                                                        <button
                                                            onClick=${(e) => {
                                                                const filas = prompt("Number of rows:", "3");
                                                                if (!filas) return;
                                                                const columnas = prompt("Number of columns:", "3");
                                                                
                                                                if (filas && columnas) {
                                                                    const filasNum = parseInt(filas);
                                                                    const columnasNum = parseInt(columnas);
                                                                    
                                                                    if (!isNaN(filasNum) && !isNaN(columnasNum) && filasNum > 0 && columnasNum > 0) {
                                                                        generateTable(filasNum, columnasNum);
                                                                        e.currentTarget.closest('.menu-content').style.display = "none";
                                                                    }
                                                                }
                                                            }}
                                                        >
                                                            Custom Table
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 24 18" style="pointer-events: none;"><path fill="currentColor" d="m12 15.4l-6-6L7.4 8l4.6 4.6L16.6 8L18 9.4z"></path></svg>
                                        </button>
                                        <div class="toolbar-separator"></div>
                                        <button
                                            onClick=${() => {
                                                const newValue = !showPreview;
                                                setShowPreview(newValue);
                                                try {
                                                    localStorage.setItem('editorShowPreview', newValue.toString());
                                                } catch (e) {
                                                    console.warn('No se pudo guardar estado de preview:', e);
                                                }
                                            }}
                                            class=${showPreview ? "active" : ""}
                                            title="Show/Hide Preview"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 23 18" style="pointer-events: none;"><path fill="currentColor" d="M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.587 1.413T19 21zm0-2h14V7H5zm7-2q-2.05 0-3.662-1.112T6 13q.725-1.775 2.338-2.887T12 9t3.663 1.113T18 13q-.725 1.775-2.337 2.888T12 17m0-2.5q-.625 0-1.062-.437T10.5 13t.438-1.062T12 11.5t1.063.438T13.5 13t-.437 1.063T12 14.5m0 1q1.05 0 1.775-.725T14.5 13t-.725-1.775T12 10.5t-1.775.725T9.5 13t.725 1.775T12 15.5"/></svg>
                                        </button>
                                        <button
                                            onClick=${() => {
                                                const newPosition = previewPosition === "right" ? "bottom" : "right";
                                                setPreviewPosition(newPosition);
                                                try {
                                                    localStorage.setItem('editorPreviewPosition', newPosition);
                                                } catch (e) {
                                                    console.warn('No se pudo guardar posición de preview:', e);
                                                }
                                            }}
                                            class=${showPreview
                                                ? ""
                                                : "disabled"}
                                            title="Change Preview Position"
                                            disabled=${!showPreview}
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 23 18" style="pointer-events: none;"><g fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M8.5 9.5L6 12l2.5 2.5m7-5L18 12l-2.5 2.5"/><path d="M2 15V9a4 4 0 0 1 4-4h12a4 4 0 0 1 4 4v6a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4Z"/></g></svg>
                                        </button>
                                    </div>
                                    <button
                                        onClick=${handleCopy}
                                        class="copy-button"
                                        style="display: contents;"
                                    >
                                        <svg
                                            width="16"
                                            height="16"
                                            viewBox="0 0 16 16"
                                            fill="none"
                                            xmlns="http://www.w3.org/2000/svg"
                                            style="min-width: 16px; min-height: 16px;"
                                        >
                                            <path
                                                d="M13 13H7a2 2 0 01-2-2V5a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2z"
                                                stroke="currentColor"
                                                stroke-width="2"
                                            />
                                            <path
                                                d="M3 11V3a2 2 0 012-2h6"
                                                stroke="currentColor"
                                                stroke-width="2"
                                                stroke-linecap="round"
                                            />
                                        </svg>
                                    </button>
                                </div>
                                <div
                                    class="editor-content ${previewPosition} ${!showPreview
                                        ? "preview-hidden"
                                        : ""}"
                                >
                                    <div
                                        ref=${containerRef}
                                        class="monaco-editor-container"
                                        style="display: ${showPreview &&
                                        previewPosition == "bottom"
                                            ? "none"
                                            : "flex"};"
                                        value=${markdown}
                                    />
                                    <div
                                        class="markdown-preview entry-content"
                                        dangerouslySetInnerHTML=${{
                                            __html: preview,
                                        }}
                                    />
                                </div>
                            </div>
                        </main>

                        <footer class="footer">
                            <p>© 2025 Blog Code.</p>
                        </footer>
                    </div>
                `;
            }

            render(html`<${MarkdownEditor} />`, document.getElementById("app"));
            
            // Inicializar la barra lateral después de renderizar
            // Con un pequeño timeout para asegurar que el DOM está listo
            setTimeout(() => {
                initSidebar([]);
            }, 0);
        </script>
    </body>
</html>
