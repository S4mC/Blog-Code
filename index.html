<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Blog Code</title>
        <link rel="icon" type="image/png" sizes="32x32" href="Icon.ico">
        <link rel="stylesheet" href="cdn/font/ubuntu-font.css" />
        <link rel="stylesheet" href="styles.css" />
        <link rel="stylesheet" href="cdn/prism/prism-dark-svc.css" />
        <script src="cdn/prism/prism-core.min.js"></script>
        <script src="cdn/prism/prism-autoloader.min.js"></script>
        <!-- <script src="script-all-pages.js"></script> -->
        <script type="importmap">
            {
                "imports": {
                    "preact": "./cdn/preact/preact.mjs",
                    "preact/hooks": "./cdn/preact/hooks.mjs",
                    "htm/preact": "./cdn/preact/htm-preact.mjs"
                }
            }
        </script>
        <style>
            #sidebarToggle{
                display: none;
            }
            
            /* Transitions between pages */
            /* ::view-transition-old(root) {
                animation: slide-out-to-right 0.5s forwards;
                z-index: 2;
            }

            ::view-transition-new(root) {
                animation: do-nothing-animation 0.5s forwards;
                z-index: 1;
            }

            @keyframes slide-out-to-right {
                from {
                    transform: translate(0);
                }
                to {
                    transform: translate(100%);
                }
            } */
        </style>
    </head>
    <body>
        <div id="app"></div>

        <script type="module">
            import { render } from "preact";
            import { useState, useEffect } from "preact/hooks";
            import { html } from "htm/preact";
            import { Header } from "./components/Header.js";

            function BlogList({ entries }) {
                return html`
                    <div class="blog-list">
                        ${entries.map(
                            (entry) => html`
                                <article
                                    key=${entry.path}
                                    class="blog-entry-card"
                                >
                                    <h3>
                                        <a
                                            href=${`./entrada.html?path=${encodeURIComponent(
                                                entry.path
                                            )}`}
                                        >
                                            ${entry.title}
                                        </a>
                                    </h3>
                                    <p class="entry-summary">
                                        ${entry.summary}
                                    </p>
                                    <div class="entry-meta">
                                        <span class="entry-date"
                                            >${entry.date}</span
                                        >
                                        ${entry.tags &&
                                        html`
                                            <div class="entry-tags">
                                                ${entry.tags.map(
                                                    (tag) => html`
                                                        <span
                                                            key=${tag}
                                                            class="tag"
                                                            >${tag}</span
                                                        >
                                                    `
                                                )}
                                            </div>
                                        `}
                                    </div>
                                </article>
                            `
                        )}
                    </div>
                `;
            }

            function App() {
                const [entries, setEntries] = useState([]);

                useEffect(() => {
                    fetch("./buscador.json")
                        .then((res) => res.json())
                        .then((data) => setEntries(data.entries || []))
                        .catch((err) =>
                            console.error("Error loading entries:", err)
                        );
                }, []);

                const handleNavigateToEntry = (entry) => {
                    window.location.href = `./entrada.html?path=${encodeURIComponent(
                        entry.path
                    )}`;
                };

                return html`
                    <div class="app">
                        <${Header} showSearch=${true} onNavigateToEntry=${handleNavigateToEntry} />

                        <main class="main-container">
                            <${BlogList} entries=${entries} />
                        </main>

                        <footer class="footer">
                            <p>Â© 2025 Blog Code.</p>
                        </footer>
                    </div>
                `;
            }

            render(html`<${App} />`, document.getElementById("app"));
        </script>
    </body>
</html>
